angular.module("YTPlaylistManager",["ui.router","ngAnimate","ui.bootstrap","LocalStorageModule"]).constant("$config",{CLIENT_ID:"877549163404-chjiknp3ffeiatmb2mcb8dfp23u7sm8q.apps.googleusercontent.com",SCOPE:"https://www.googleapis.com/auth/youtube",API_KEY:"AIzaSyDJIOlGzyjPFEQ5j-Q2qEJVbOJtgqmby_Y"}).run(["$rootScope","$location","localStorageService","channel","YTResourceProvider",function(a,b,c,d,e){a.$on("$stateChangeStart",function(b,c,d){var e=c.data.requireLogin;e&&angular.isUndefined(a.authorized)&&b.preventDefault()});var f=c.get("options");null!==f&&(d.options=f,d.options.rememberMe?$(window).load(function(){e.auth().then(function(c){var e=c.result.items[0];a.authorized=!0,d.basic={authorized:!0,title:e.snippet.title,id:e.id,thumbnails:e.snippet.thumbnails},a.$emit("logged"),("/login"===b.url()||"/"===b.url())&&b.url("/playlists")},function(a){alert("Login failed")})}):b.url("/"))}]),angular.module("YTPlaylistManager").config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/hello");var c={};c.app={name:"app","abstract":!0,sticky:!0,templateUrl:"views/app.html",controller:"mainCtrl",data:{requireLogin:!0}},c.hello={name:"hello",parent:"app",url:"/hello",templateUrl:"views/hello.html",data:{requireLogin:!1}},c.playlists={name:"playlists",parent:"app",url:"/playlists",templateUrl:"views/playlists.html",controller:"playlistCtrl",data:{requireLogin:!1}},c.videos={name:"videos",parent:"app",url:"/:id/videos",templateUrl:"views/videos.html",controller:"videosCtrl",data:{requireLogin:!1}},c.channel={name:"channel",parent:"app",url:"/channel",templateUrl:"views/channel.html",data:{requireLogin:!0}},c.settings={name:"settings",parent:"app",url:"/settings",templateUrl:"views/settings.html",controller:"settingsCtrl",data:{requireLogin:!0}},c.login={name:"login",parent:"app",url:"/login",templateUrl:"views/login.html",controller:"loginCtrl",data:{requireLogin:!1}},c.search={name:"search",parent:"app",url:"/search",templateUrl:"views/search.html",controller:"searchCtrl",data:{requireLogin:!1}},c.compare={name:"compare",parent:"app",url:"/compare",templateUrl:"views/compare.html",controller:"playlistCtrl",data:{requireLogin:!1}},$.each(c,function(b,c){a.state(c)})}]),angular.module("YTPlaylistManager").directive("playlistGrid",function(){return{restrict:"E",replace:!0,templateUrl:"js/directives/playlist-grid/playlist-grid.html",link:function(a,b,c,d){a.resizeTh()}}}),angular.module("YTPlaylistManager").directive("playlistList",function(){return{restrict:"E",replace:!0,templateUrl:"js/directives/playlist-list/playlist-list.html"}}),angular.module("YTPlaylistManager").directive("ytItemGrid",function(){return{restrict:"E",templateUrl:"js/directives/yt-item-grid/yt-item-grid.html",replace:!0}}),angular.module("YTPlaylistManager").directive("ytItemList",function(){return{restrict:"E",replace:!0,templateUrl:"js/directives/yt-item-list/yt-item-list.html"}}),angular.module("YTPlaylistManager").factory("YTResourceProvider",["$q","$config",function(a,b){var c={};return c.auth=function(){var c=a.defer();return gapi.client.setApiKey=b.API_KEY,gapi.auth.authorize({client_id:b.CLIENT_ID,scope:b.SCOPE,immediate:!0},function(){gapi.client.load("youtube","v3",function(){var a=gapi.client.youtube.channels.list({mine:!0,part:"id,snippet"});a.execute(function(a){a.error?c.reject(a.error):c.resolve(a)})})}),c.promise},c.sendRequest=function(b,c){var d=a.defer(),e=c.split("."),f=gapi.client.youtube[e[0]][e[1]](b);return f.execute(function(a){a.error?d.reject(a.error):d.resolve(a)}),d.promise},c}]),angular.module("YTPlaylistManager").service("channel",["$rootScope",function(a){var b={basic:{title:"Stranger",authorized:!1},options:{maxResults:24,position:"last",rememberMe:!1,autoplay:!1,topSection:"big",defaultLayout:"grid"}};return b}]),angular.module("YTPlaylistManager").controller("loginCtrl",["$rootScope","$scope","channel","$location","YTResourceProvider",function(a,b,c,d,e){b.checkAuth=function(){e.auth().then(function(e){var f=e.result.items[0];a.authorized=!0,c.basic={authorized:!0,title:f.snippet.title,id:f.id,thumbnail:f.snippet.thumbnails.high.url},b.$parent.success("success","logged"),a.$emit("logged"),"/login"===d.url()&&d.url("/playlists")},function(a){b.$parent.error("error",a.error)})}}]),angular.module("YTPlaylistManager").controller("mainCtrl",["$rootScope","$scope","channel","YTResourceProvider",function(a,b,c,d){function e(a,c){b.infoMsg=c,$("#info-box").addClass("visible").addClass(a);var d=setTimeout(function(){$("#info-box").removeClass("visible").addClass(a)},7500);$("#info-box").find("span").on("click",function(){clearTimeout(d),$("#info-box").removeClass("visible").addClass(a)})}b.channel=c,b.success=function(a){e("success",a)},b.error=function(a){e("error",a)},b.translateDuration=function(a){var b=a.length,c=a.indexOf("T");a=-1!=c?a.slice(c+1,b):a.slice(2,b);var d=a.indexOf("H"),e=-1!=d?a.slice(0,d):"",f=a.indexOf("M"),g=-1!=f?a.slice(d+1,f):"0",h=a.indexOf("S"),i=-1!=h?a.slice(f+1,h):"",j="";return""!=e&&(j+=e+":",1==g.length&&(g="0"+g)),""!=g&&(j+=g+":",1==i.length?i="0"+i:0==i.length&&(i="00")),""!=i&&(j+=i),j},b.addCommas=function(a){for(var b=[],c="",d=a.length;d>0;d-=3){var e=d>2?d-3:0,f=a.slice(e,d);b.push(f)}for(var d=b.length-1;d>=0;d--)c+=d?b[d]+",":b[d];return c},b.progress=function(a){var b=$("#progress .loading-bar");b.css("opacity",1),b.css("width",a+"vw"),a>99&&b.css("opacity",0)},$(document).ready(function(){a.resizeTh=function(){var a=$(".yt-items-list").find(".thumb"),b=parseInt(a.width(),10);a.css("height",b/1.778)};$("#collapse").on("click",function(){$("[size-sensitive]").toggleClass("small")}),$(document).on("click",function(){$("nav").removeClass("opened")}),$(".toggle-nav").on("click",function(a){a.stopPropagation(),$("nav").toggleClass("opened")}),$(window).resize(a.resizeTh),$(window).resize(a.resizePlayer)}),b.logout=function(){gapi.auth.signOut()},b.addVideo=function(a){var e={part:"snippet",snippet:{playlistId:a.id,resourceId:{kind:"youtube#video",videoId:c.activePlaylist.videos[c.activeVideo].id}}};d.sendRequest(e,"playlistItems.insert").then(function(a){b.success("Added video")},function(a){console.log(a),b.error("Cannot add video")})},b.rateVideo=function(a){var b=c.activePlaylist.videos[c.activeVideo],e={id:b.id};console.log(b),e.rating=b.rating===a?"none":a,d.sendRequest(e,"videos.rate").then(function(c){b.rating=a},function(a){console.log(a)})},b.$watch(function(){return c.activeVideo},function(){angular.isDefined(c.activePlaylist)&&(b.video=c.activePlaylist.videos[c.activeVideo])})}]),angular.module("YTPlaylistManager").controller("modalCtrl",["$scope","$modalInstance","data",function(a,b,c){angular.isDefined(c.playlist)?a.playlist=c.playlist:a.playlist={snippet:{},status:{},contentDetails:{itemCount:0}},a.title=c.title,a.buttonText=c.buttonText,a.dismiss=function(){b.dismiss("dismissed")},a.create=function(){b.close(a.playlist)}}]),angular.module("YTPlaylistManager").controller("playerCtrl",["$scope","channel",function(a,b){var c=function(c){a.prevVideo=b.activePlaylist.videos[--c],a.nextVideo=b.activePlaylist.videos[c+2]},d=function(d){b.options.autoplay&&0==d.data&&(b.activeVideo++,b.player.loadVideoById(b.activePlaylist.videos[b.activeVideo].id),c(b.activeVideo),a.$apply()),1==d.data&&(c(b.activeVideo),a.$apply())};a.playPreviousVideo=function(){b.activeVideo--,b.player.loadVideoById(b.activePlaylist.videos[b.activeVideo].id),c(b.activeVideo)},a.playNextVideo=function(){b.activeVideo++,b.player.loadVideoById(b.activePlaylist.videos[b.activeVideo].id),c(b.activeVideo)},a.init=function(){$(window).load(function(){b.player=new YT.Player("player",{height:"100%",width:"100%",videoId:"o3mP3mJDL2k",events:{onStateChange:d}})})}}]),angular.module("YTPlaylistManager").controller("playlistCtrl",["$rootScope","$scope","channel","YTResourceProvider","$modal","$location","$q",function(a,b,c,d,e,f,g){b.options=c.options,b.currentPage=1;var h=0;b.init=function(){if(c.basic.authorized&&angular.isUndefined(c.playlists))b.get();else if(c.basic.authorized){var a=b.options.maxResults*(b.currentPage-1);b.filteredPlaylists=c.playlists.slice(a,a+b.options.maxResults),b.totalItems=c.playlists.length}},b.get=function(){var a={channelId:c.basic.id,maxResults:c.options.maxResults,part:"snippet,contentDetails,status"};angular.isDefined(b.pageToken)&&(a.pageToken=b.pageToken),d.sendRequest(a,"playlists.list").then(function(a){b.pageToken=a.result.nextPageToken,c.playlists=a.result.items,$.each(c.playlists,function(a){c.playlists[a].videos=[],-1===c.playlists[a].snippet.thumbnails.medium.url.indexOf("mqdefault")&&(c.playlists[a].snippet.thumbnails.medium.url="img/noth.png")});var d=b.options.maxResults*(b.currentPage-1);b.filteredPlaylists=c.playlists.slice(d,d+b.options.maxResults),b.totalItems=c.playlists.length},function(a){console.log(a.error),b.$parent.error("Error")})};var i=function(a){c.activePlaylist=c.playlists[a],c.player.loadVideoById(c.activePlaylist.videos[0].id),c.activeVideo=0},j=function(a,e,f,g){var i=a.length,k=100/i;if(angular.isDefined(a[e])){var l={id:a[e].snippet.resourceId.videoId,part:"snippet,contentDetails,statistics"};d.sendRequest(l,"videos.list").then(function(i){if(i.result.items.length){var m=angular.copy(i.result.items[0]);m.playlistItemId=a[e].id,m.contentDetails.duration=b.$parent.translateDuration(m.contentDetails.duration),m.statistics.viewCount=b.$parent.addCommas(m.statistics.viewCount),f.videos.push(m),f.videos.length!==c.options.maxResults&&f.videos.length!==f.contentDetails.itemCount||!angular.isDefined(g)||g();({id:m.id});d.sendRequest(l,"videos.getRating").then(function(a){m.rating=a.result.items[0].rating},function(a){console.log(a)})}h+=k,b.$parent.progress(h.toFixed(2)),j(a,e+1,f,g)},function(b){console.log(b),j(a,e,f,g),h=0})}},k=function(a,e){var f={playlistId:c.playlists[a].id,part:"snippet",maxResults:c.options.maxResults};angular.isDefined(b.pageToken)&&(f.pageToken=b.pageToken),d.sendRequest(f,"playlistItems.list").then(function(d){b.pageToken=d.nextPageToken,j(d.result.items,0,c.playlists[a],e)},function(a){console.log(a.error),b.$parent.error("Error")})};b.playPlaylist=function(a){c.playlists[a].videos.length?(c.player.loadVideoById(c.playlists[a].videos[0].id),i(a)):k(a,function(){i(a)})},b.addPlaylist=function(){var a=e.open({templateUrl:"views/modals/PlaylistModal.html",size:"lg",controller:"modalCtrl",resolve:{data:function(){return{title:"Create new playlist",buttonText:"Create"}}}});a.result.then(function(a){var e={part:"snippet,status,contentDetails",resource:a};d.sendRequest(e,"playlists.insert").then(function(a){c.playlists.unshift(a),b.$parent.success('Created "'+a.snippet.title+'"')},function(a){console.log(a),b.$parent.error("Error")})},function(a){console.log(a)})},b.editPlaylist=function(a){var f=e.open({templateUrl:"views/modals/PlaylistModal.html",size:"lg",controller:"modalCtrl",resolve:{data:function(){return{title:'Edit playlist "'+c.playlists[a].snippet.title+'"',playlist:c.playlists[a],buttonText:"Save"}}}});f.result.then(function(e){var f={id:c.playlists[a].id,part:"snippet,status",snippet:e.snippet,status:e.status};d.sendRequest(f,"playlists.update").then(function(d){b.$parent.success('Successfuly updated "'+c.playlists[a].snippet.title+'"')},function(a){console.log(a),b.$parent.error("Error")})})},b.deletePlaylist=function(a){var e={id:c.playlists[a].id};d.sendRequest(e,"playlists.delete").then(function(d){b.$parent.success('Successfuly deleted "'+c.playlists[a].snippet.title+'"'),c.playlists.splice(a,1)},function(a){console.log(a),b.$parent.error("Error")})},b.openPlaylist=function(b){k(b,function(){f.url("/"+c.playlists[b].id+"/videos")}),a.openedPlaylist=c.playlists[b]},b.pageChanged=function(){b.filteredPlaylists=c.playlists.slice(currentPage*b.options.maxResults,currentPage*b.options.maxResults+b.options.maxResults)},b.setPlaylist=function(a){k(b["playlist"+a]),1===a?b.playlistLeft=c.playlists[b["playlist"+a]]:b.playlistRight=c.playlists[b["playlist"+a]]},a.$on("logged",b.get)}]),angular.module("YTPlaylistManager").controller("searchCtrl",["$scope","channel","YTResourceProvider",function(a,b,c){a.options=b.options;var d;a.results=[],a.currentResults=[],a.currentPage=1,a.search=function(){(a.keywords!=d||angular.isUndefined(a.keywords))&&(a.results=[],a.nextPageToken="",d=a.keywords);var e={q:d,part:"snippet",maxResults:b.options.maxResults};a.nextPageToken&&(e.pageToken=a.nextPageToken),c.sendRequest(e,"search.list").then(function(b){var d=b.result.items;a.nextPageToken=b.nextPageToken,$.each(d,function(b){var e={id:d[b].id.videoId,part:"snippet,contentDetails,statistics"};c.sendRequest(e,"videos.list").then(function(b){var d=b.result.items[0],e={id:d.id,snippet:angular.copy(d.snippet),contentDetails:angular.copy(d.contentDetails),statistics:angular.copy(d.statistics)};e.contentDetails.duration=a.$parent.translateDuration(e.contentDetails.duration),e.statistics.viewCount=a.$parent.addCommas(e.statistics.viewCount);var f=a.options.maxResults*(a.currentPage-1);a.filteredResults=a.results.slice(f,f+a.options.maxResults),a.totalItems=a.results.length,c.sendRequest({id:e.id},"videos.getRating").then(function(a){e.rating=a.result.items[0].rating},function(a){console.log(a)}),a.results.push(e)},function(){console.log("error")})}),a.totalItems=a.results.length},function(b){a.$parent.error(b.error)})},a.playVideo=function(c){b.player.loadVideoById(a.results[c].id),b.activePlaylist={videos:a.results},b.activeVideo=c},a.pageChanged=function(){var b=a.options.maxResults*(a.currentPage-1);a.filteredResults=a.results.slice(b,b+a.options.maxResults)},$(document).on("keyup",function(b){13==b.which&&a.search(a.keywords)})}]),angular.module("YTPlaylistManager").controller("settingsCtrl",["$scope","channel","localStorageService",function(a,b,c){var d=c.get("options");a.options={},a.options=b.options,$.each(d,function(b,c){a.options[b]=d[b]}),a.saveOptions=function(){b.options=a.options,c.set("options",a.options),a.$parent.success("saved")}}]),angular.module("YTPlaylistManager").controller("videosCtrl",["$rootScope","$scope","channel","$stateParams","$location","YTResourceProvider",function(a,b,c,d,e,f){if(b.options=c.options,angular.isDefined(c.playlists)){b.videos=a.openedPlaylist.videos;var g=b.options.maxResults*(b.currentPage-1);b.filteredVideos=b.videos.slice(g,g+b.options.maxResults)}else e.url("/playlists");b.playVideo=function(b){c.activePlaylist=a.openedPlaylist,c.player.loadVideoById(c.activePlaylist.videos[b].id),c.activeVideo=b},b.deleteVideo=function(c){var d={id:a.openedPlaylist.videos[c].playlistItemId};f.sendRequest(d,"playlistItems.delete").then(function(d){b.$parent.success("Deleted"),a.openedPlaylist.videos.splice(c,1)},function(a){console.log(a)})};var h=function(b){var c={id:b.video.playlistItemId,part:"snippet",snippet:{playlistId:a.openedPlaylist.id,resourceId:{kind:"youtube#video",videoId:b.video.id},position:b.desiredPosition}};f.sendRequest(c,"playlistItems.update").then(function(c){a.openedPlaylist.videos.splice(b.itemIndex,1);a.openedPlaylist.videos.splice(b.desiredPosition,0,b.video)},function(a){console.log(a)})};b.moveFirst=function(b){h({desiredPosition:0,itemIndex:b,video:a.openedPlaylist.videos[b]})},b.moveUp=function(b){h({desiredPosition:b-1,itemIndex:b,video:a.openedPlaylist.videos[b]})},b.moveDown=function(b){h({desiredPosition:b+1,itemIndex:b,video:a.openedPlaylist.videos[b]})},b.moveLast=function(b){h({desiredPosition:a.openedPlaylist.contentDetails.itemCount-1,itemIndex:b,video:a.openedPlaylist.videos[b]})};var i=function(a,b){var c={id:b.id,rating:a};f.sendRequest(c,"videos.rate").then(function(c){b.rating=a},function(a){console.log(a)})};b.likeVideo=function(b){var c="like"!==a.openedPlaylist.videos[b].rating?"like":"none";i(c,a.openedPlaylist.videos[b])},b.dislikeVideo=function(b){var c="dislike"!==a.openedPlaylist.videos[b].rating?"dislike":"none";i(c,a.openedPlaylist.videos[b])}}]);